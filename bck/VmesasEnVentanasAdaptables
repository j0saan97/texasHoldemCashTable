<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vista Multimesa Draggable/Resizable</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif;
            background-color: #1a1a1a;
            display: block; /* Debe ser bloque para permitir ventanas absolutas */
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Evita que el body tenga scroll si las ventanas se salen */
        }

        /* ---------------------------------------------------- */
        /* CONTENEDOR DE VENTANA INDEPENDIENTE */
        /* ---------------------------------------------------- */
        .poker-window {
            position: absolute; /* Esencial para el arrastre y solapamiento */
            top: 50px;
            left: 50px;
            width: 400px; /* Tama√±o inicial por defecto */
            height: 350px;
            background-color: #242424; 
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            resize: none; /* Deshabilitado el resize nativo del navegador */
            min-width: 300px;
            min-height: 250px;
            z-index: 10; /* Z-index base */
        }
        
        /* CABECERA PARA ARRASTRAR */
        .window-header {
            cursor: grab;
            user-select: none;
        }

        /* ---------------------------------------------------- */
        /* CONTROL DE REDIMENSIONAMIENTO (DRAG HANDLES) */
        /* ---------------------------------------------------- */
        .resize-handle {
            position: absolute;
            width: 15px;
            height: 15px;
            z-index: 99; 
            background: transparent;
        }
        .resize-handle-br { bottom: 0; right: 0; cursor: nwse-resize; } /* Bottom-Right */
        .resize-handle-b { bottom: 0; left: 50%; transform: translateX(-50%); cursor: ns-resize; width: 80%; height: 10px;} /* Bottom */
        
        /* ---------------------------------------------------- */
        /* ESTILOS INTERNOS DE LA MESA (Adaptados al tama√±o de ventana)*/
        /* ---------------------------------------------------- */
        .table-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            height: calc(100% - 32px); /* Altura menos el header */
            padding: 8px;
        }

        .poker-table {
            position: relative;
            /* La mesa interna usa porcentajes para adaptarse al slot din√°mico */
            width: 90%; 
            height: 65%; 
            background-color: #0b5331; 
            border: 8px solid #202020; 
            border-radius: 50% / 60%; 
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.7), inset 0 0 8px rgba(0, 0, 0, 0.4);
        }

        /* Estilos de elementos internos (asientos, cartas) mantienen la proporci√≥n */
        .player-seat {
            position: absolute;
            width: 80px; /* Reducido para mejor ajuste din√°mico */
            height: 50px; 
            z-index: 10;
            border: 1px solid #444; 
            background-color: #1f1f1f; 
            border-radius: 6px; 
            box-shadow: 0 0 2px rgba(0, 0, 0, 0.5);
            padding: 3px; 
            font-size: 0.6rem;
        }

        /* Posicionamiento de los 6 asientos (Ajustado para el tama√±o reducido) */
        .seat-1 { top: -10px; left: 10%; transform: translateX(-50%); } 
        .seat-2 { top: -10px; right: 10%; transform: translateX(50%); } 
        .seat-3 { top: 50%; right: -30px; transform: translateY(-50%); } 
        .seat-6 { top: 50%; left: -30px; transform: translateY(-50%); } 
        .seat-4 { bottom: -10px; right: 10%; transform: translateX(50%); } 
        .seat-5 { bottom: -10px; left: 10%; transform: translateX(-50%); } 
        
        .card-placeholder { width: 20px; height: 30px; font-size: 0.6rem; }
        .action-bar-compact { width: 95%; padding: 4px; }
        .action-bar-compact button { font-size: 0.5rem; padding: 3px 6px; }
        .stack-display { font-size: 0.7rem; }

        .position-chip {
             width: 12px; height: 12px; font-size: 0.5rem;
             background-color: #f7d24a; color: #1a1a1a;
             border-radius: 50%;
             display: flex; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

    <!-- El contenido de las 8 mesas se generar√° din√°micamente como ventanas absolutas -->
    
    <!-- JavaScript para la l√≥gica de ventana din√°mica -->
    <script>
        // --- DATOS DE EJEMPLO ---
        const jugadoresEjemplo = [
            { id: 1, nombre: "Jugador 1", stack: 18.951, bet: 0.11, posClass: "seat-6", avatar: "üÉè" },
            { id: 2, nombre: "Jugador 2", stack: 16.879, bet: 0.11, posClass: "seat-1", avatar: "üë§" },
            { id: 3, nombre: "Jugador 3", stack: 35.080, bet: 0.11, posClass: "seat-2", avatar: "üë±‚Äç‚ôÄÔ∏è", isDealer: true },
            { id: 4, nombre: "Jugador 4", stack: 38.263, bet: 0.16, posClass: "seat-3", avatar: "üë§" },
            { id: 5, nombre: "Jugador 5", stack: 23.966, bet: 0.16, posClass: "seat-5", avatar: "üë§" },
            { id: 6, nombre: "Jugador 6", stack: 19.610, bet: 0, posClass: "seat-4", avatar: "üë§", isAction: true, handRank: "K-High" }
        ];
        
        let zIndexCounter = 10; // Contador para gestionar el solapamiento (prioridad de la ventana)
        let isDragging = false;
        let isResizing = false;
        let activeWindow = null;
        let offsetX, offsetY;
        let initialX, initialY, initialWidth, initialHeight;
        let resizeDirection = '';


        // --- FUNCIONES DE RENDERIZADO ---
        
        function generarHTMLJugador(jugador) {
            const betChips = jugador.bet > 0 
                ? `<div class="absolute -top-3 left-1/2 transform -translate-x-1/2 flex flex-col items-center">
                      <div class="text-[0.6rem] font-semibold text-white bg-red-700/80 px-0.5 rounded-sm mb-0.5">${jugador.bet} ‚Ç¨</div>
                      <div class="w-3 h-3 bg-red-700 rounded-full border border-red-500 shadow-md"></div>
                   </div>`
                : '';
                
            const cardBacks = `
                <div class="w-4 h-6 bg-gray-700 rounded-sm border-2 border-gray-500 flex items-center justify-center shadow-inner">
                    <span class="text-white text-xs">W</span>
                </div>
                <div class="w-4 h-6 bg-gray-700 rounded-sm border-2 border-gray-500 flex items-center justify-center shadow-inner">
                    <span class="text-white text-xs">W</span>
                </div>
            `;

            const handInfo = jugador.handRank 
                ? `<div class="text-yellow-400 text-[0.6rem] font-semibold mt-0.5">${jugador.handRank}</div>`
                : '';

            const dealerButton = jugador.isDealer 
                ? `<div class="position-chip absolute -right-1 top-1/2 transform -translate-y-1/2">D</div>`
                : '';

            return `
                <div id="player-${jugador.id}" class="player-seat ${jugador.posClass} ${jugador.isAction ? 'ring-1 ring-yellow-500 ring-opacity-70' : ''}">
                    ${dealerButton}
                    <div class="flex flex-col items-center text-center p-0.5">
                        <div class="w-5 h-5 bg-gray-600 rounded-full mb-0.5 flex items-center justify-center text-[0.6rem] text-white border border-gray-400">
                            ${jugador.avatar}
                        </div>
                        <div class="flex flex-col items-center w-full">
                            <span class="stack-display">$${jugador.stack.toFixed(3)}</span>
                            ${handInfo}
                        </div>
                        
                        <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 flex gap-0.5">
                            ${cardBacks}
                        </div>
                        
                        <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2">
                            <div class="flex flex-col items-center">
                                ${betChips}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generarHTMLMesa(mesaId) {
            const jugadoresHTML = jugadoresEjemplo.map(generarHTMLJugador).join('');

            return `
                <div id="table-${mesaId}" class="poker-window" style="left: ${50 + (mesaId * 30)}px; top: ${50 + (mesaId * 30)}px;">
                    
                    <!-- Cabecera de la ventana (para arrastrar) -->
                    <div class="window-header h-8 bg-gray-700/50 flex items-center justify-between px-3 text-white text-sm rounded-t-lg">
                        Mesa #${mesaId} - 6 Max | $0.05/$0.10 
                        <span class="text-xs text-yellow-300">¬°Acci√≥n!</span>
                    </div>

                    <!-- Contenido principal de la mesa -->
                    <div class="table-content">
                        <div class="poker-table">
                            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center">
                                <div class="text-white text-sm font-bold bg-black/40 px-1 py-0.5 rounded-md mb-1">Bote: 2.166 ‚Ç¨</div>
                                <div class="flex gap-0.5 justify-center">
                                    <div class="card-placeholder bg-white text-red-600 flex items-center justify-center">A</div>
                                    <div class="card-placeholder bg-gray-500/80"></div>
                                    <div class="card-placeholder bg-gray-500/80"></div>
                                    <div class="card-placeholder bg-gray-500/80"></div>
                                    <div class="card-placeholder bg-gray-500/80"></div>
                                </div>
                            </div>
                            <div class="player-seats-container">${jugadoresHTML}</div>
                        </div>
                        
                        <!-- Barrita de Acciones -->
                        <div class="action-bar-compact bg-gray-800">
                            <button class="bg-red-800 text-white rounded-md">Fold</button>
                            <button class="bg-orange-600 text-white rounded-md">Call 438</button>
                            <button class="bg-green-700 text-white rounded-md">Raise 1.2k</button>
                        </div>
                    </div>

                    <!-- Controles de Redimensionamiento (solo en Bottom-Right) -->
                    <div class="resize-handle resize-handle-br" data-direction="br"></div>
                    <div class="resize-handle resize-handle-b" data-direction="b"></div>

                </div>
            `;
        }


        // --- L√ìGICA DE GESTI√ìN DE VENTANAS (Arrastrar, Redimensionar, Z-Index) ---

        /** Mueve la ventana al frente (mayor z-index) al hacer click */
        function bringToFront(windowElement) {
            if (activeWindow && activeWindow !== windowElement) {
                activeWindow.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.5)';
            }
            if (windowElement.style.zIndex < zIndexCounter) {
                zIndexCounter++;
                windowElement.style.zIndex = zIndexCounter;
            }
            windowElement.style.boxShadow = '0 10px 30px rgba(255, 255, 0, 0.2)'; // Sombra de foco
            activeWindow = windowElement;
        }

        /** Inicializa el arrastre (DRAG) */
        function startDrag(e) {
            e.preventDefault();
            const windowElement = e.target.closest('.poker-window');
            if (!windowElement) return;

            bringToFront(windowElement);

            isDragging = true;
            activeWindow = windowElement;
            
            // Calcula el offset (posici√≥n del click dentro de la ventana)
            offsetX = e.clientX - windowElement.offsetLeft;
            offsetY = e.clientY - windowElement.offsetTop;

            document.addEventListener('mousemove', dragMove);
            document.addEventListener('mouseup', dragEnd);
        }

        /** Mueve la ventana */
        function dragMove(e) {
            if (!isDragging || !activeWindow) return;
            
            // Calcular nueva posici√≥n
            let newX = e.clientX - offsetX;
            let newY = e.clientY - offsetY;

            // Limitar el arrastre dentro de los l√≠mites de la ventana (body)
            newX = Math.max(0, Math.min(newX, window.innerWidth - activeWindow.offsetWidth));
            newY = Math.max(0, Math.min(newY, window.innerHeight - activeWindow.offsetHeight));

            activeWindow.style.left = newX + 'px';
            activeWindow.style.top = newY + 'px';
        }

        /** Finaliza el arrastre */
        function dragEnd() {
            isDragging = false;
            document.removeEventListener('mousemove', dragMove);
            document.removeEventListener('mouseup', dragEnd);
        }

        /** Inicializa el redimensionamiento (RESIZE) */
        function startResize(e) {
            e.preventDefault();
            const handle = e.target.closest('.resize-handle');
            if (!handle) return;
            
            const windowElement = handle.closest('.poker-window');
            if (!windowElement) return;

            bringToFront(windowElement);
            
            isResizing = true;
            activeWindow = windowElement;
            resizeDirection = handle.dataset.direction;
            
            // Guardar estado inicial
            initialX = e.clientX;
            initialY = e.clientY;
            initialWidth = windowElement.offsetWidth;
            initialHeight = windowElement.offsetHeight;

            document.addEventListener('mousemove', resizeMove);
            document.addEventListener('mouseup', resizeEnd);
        }

        /** Redimensiona la ventana */
        function resizeMove(e) {
            if (!isResizing || !activeWindow) return;
            
            const dx = e.clientX - initialX;
            const dy = e.clientY - initialY;
            
            let newWidth = initialWidth;
            let newHeight = initialHeight;
            
            // Solo redimensionar si la direcci√≥n lo requiere
            if (resizeDirection.includes('r')) {
                newWidth = initialWidth + dx;
            }
            if (resizeDirection.includes('b')) {
                newHeight = initialHeight + dy;
            }

            // Aplicar l√≠mites m√≠nimos
            newWidth = Math.max(newWidth, 300);
            newHeight = Math.max(newHeight, 250);

            activeWindow.style.width = newWidth + 'px';
            activeWindow.style.height = newHeight + 'px';
        }

        /** Finaliza el redimensionamiento */
        function resizeEnd() {
            isResizing = false;
            document.removeEventListener('mousemove', resizeMove);
            document.removeEventListener('mouseup', resizeEnd);
        }

        /** Inicializa todas las mesas como ventanas din√°micas */
        function inicializarMultimesa() {
            let htmlContent = '';
            // Generar las 8 mesas
            for (let i = 1; i <= 8; i++) {
                htmlContent += generarHTMLMesa(i);
            }
            document.body.insertAdjacentHTML('beforeend', htmlContent);
            
            // A√±adir Listeners
            const headers = document.querySelectorAll('.window-header');
            headers.forEach(header => {
                header.addEventListener('mousedown', startDrag);
            });

            const resizeHandles = document.querySelectorAll('.resize-handle');
            resizeHandles.forEach(handle => {
                handle.addEventListener('mousedown', startResize);
            });
            
            const windows = document.querySelectorAll('.poker-window');
            windows.forEach(win => {
                 // Al hacer clic en cualquier parte de la ventana, traerla al frente
                win.addEventListener('mousedown', (e) => {
                    // Solo si no estamos arrastrando o redimensionando ya
                    if (!isDragging && !isResizing) {
                       bringToFront(win);
                    }
                });
            });

            // Dar foco inicial a la primera ventana
            const firstWindow = document.getElementById('table-1');
            if (firstWindow) {
                bringToFront(firstWindow);
            }

            console.log(`Inicializadas 8 mesas como ventanas din√°micas (Arrastrables y Redimensionables).`);
        }

        document.addEventListener('DOMContentLoaded', inicializarMultimesa);
    </script>
</body>
</html>